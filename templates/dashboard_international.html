{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<style>
    /* Basic styles from dashboard_clean.html for consistency */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    :root {
        --odoo-primary: #875A7B;
        --odoo-primary-dark: #6B4563;
    }
    body {
        margin: 0;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        color: #2c3e50;
    }
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(135deg, var(--odoo-primary) 0%, var(--odoo-primary-dark) 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(135, 90, 123, 0.3);
        margin-bottom: 25px;
        font-family: 'Poppins', sans-serif;
    }
    .header-left h1 { margin: 0; font-size: 24px; }
    .header-nav { display: flex; gap: 15px; align-items: center; }
    .btn-nav, .btn-salir {
        display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px;
        border: none; border-radius: 6px; cursor: pointer; font-weight: 600;
        font-size: 14px; text-decoration: none; transition: all 0.2s ease;
    }
    .btn-nav { background-color: rgba(255, 255, 255, 0.15); color: white; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn-nav:hover { background-color: rgba(255, 255, 255, 0.25); }
    .btn-salir { background: #e74c3c; color: white; }
    .btn-salir:hover { background-color: #c0392b; }
    .dashboard-container { display: flex; flex-direction: column; gap: 25px; }
    .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
    .kpi-card { background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); text-align: center; }
    .kpi-label { font-size: 14px; color: #7f8c8d; margin-bottom: 5px; }
    .kpi-value { font-size: 24px; font-weight: bold; }
    .content-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
    .data-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .data-card h3 { margin: 0 0 20px 0; font-size: 18px; }
    .data-list { list-style: none; padding: 0; margin: 0; }
    .data-list li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #ecf0f1; }
    .data-list li:last-child { border-bottom: none; }
    .filter-form { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="header-left">
        <h1>Dashboard de Ventas Internacionales</h1>
    </div>
    <div class="header-nav">
        <a href="{{ url_for('dashboard') }}" class="btn-nav"><i class="bi bi-arrow-left-circle"></i> Volver a Ventas Nacionales</a>
        <a href="{{ url_for('logout') }}" class="btn-salir"><i class="bi bi-box-arrow-right"></i> Salir</a>
    </div>
</div>

<div class="dashboard-container">
    <!-- Filter Form -->
    <form method="POST" action="{{ url_for('dashboard_international') }}" class="filter-form">
        <input type="text" id="date_from" name="date_from" value="{{ selected_filters.date_from or '' }}" placeholder="Fecha Desde">
        <input type="text" id="date_to" name="date_to" value="{{ selected_filters.date_to or '' }}" placeholder="Fecha Hasta">
        <button type="submit" class="btn-nav">Filtrar</button>
    </form>

    <!-- KPIs -->
    <div class="kpi-row">
        <div class="kpi-card">
            <div class="kpi-label">Ventas Totales</div>
            <div class="kpi-value">S/ {{ "{:,.0f}".format(dashboard_data.total_sales) }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Cantidad Total</div>
            <div class="kpi-value">{{ "{:,.0f}".format(dashboard_data.total_quantity) }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">LÃ­neas de Venta</div>
            <div class="kpi-value">{{ dashboard_data.total_lines }}</div>
        </div>
    </div>

    <!-- Data Lists -->
    <div class="content-row">
        <div class="data-card">
            <h3>Top 10 Clientes</h3>
            <ul class="data-list">
                {% for client, data in dashboard_data.top_clients %}
                <li>
                    <span>{{ client }}</span>
                    <strong>S/ {{ "{:,.0f}".format(data.sales) }}</strong>
                </li>
                {% else %}
                <li>No hay datos de clientes.</li>
                {% endfor %}
            </ul>
        </div>

        <div class="data-card">
            <h3>Top 10 Productos</h3>
            <ul class="data-list">
                {% for product, data in dashboard_data.top_products %}
                <li>
                    <span>{{ product }}</span>
                    <strong>S/ {{ "{:,.0f}".format(data.sales) }}</strong>
                </li>
                {% else %}
                <li>No hay datos de productos.</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="data-card">
            <h3>Ventas por Vendedor</h3>
            <ul class="data-list">
                {% for seller in dashboard_data.sellers %}
                <li>
                    <span>{{ seller.name }}</span>
                    <strong>S/ {{ "{:,.0f}".format(seller.amount) }}</strong>
                </li>
                {% else %}
                <li>No hay datos de vendedores.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    flatpickr("#date_from", {
        dateFormat: "Y-m-d",
        altInput: true,
        altFormat: "d/m/Y",
    });
    flatpickr("#date_to", {
        dateFormat: "Y-m-d",
        altInput: true,
        altFormat: "d/m/Y",
    });
});
</script>
{% endblock %}
